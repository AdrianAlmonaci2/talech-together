{"version":3,"file":"SankeyChart.base.js","sourceRoot":"../src/","sources":["components/SankeyChart/SankeyChart.base.tsx"],"names":[],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport { classNamesFunction, getId } from '@fluentui/react/lib/Utilities';\nimport { ISankeyChartProps, ISankeyChartStyleProps, ISankeyChartStyles } from './SankeyChart.types';\nimport { IProcessedStyleSet } from '@fluentui/react/lib/Styling';\nimport * as d3Sankey from 'd3-sankey';\nconst getClassNames = classNamesFunction<ISankeyChartStyleProps, ISankeyChartStyles>();\n\nexport class SankeyChartBase extends React.Component<\n  ISankeyChartProps,\n  {\n    containerWidth: number;\n    containerHeight: number;\n  }\n> {\n  private _classNames: IProcessedStyleSet<ISankeyChartStyles>;\n  private chartContainer: HTMLDivElement;\n  private _reqID: number;\n  constructor(props: ISankeyChartProps) {\n    super(props);\n    this.state = {\n      containerHeight: 0,\n      containerWidth: 0,\n    };\n  }\n  public componentDidMount(): void {\n    this._fitParentContainer();\n  }\n\n  public componentDidUpdate(prevProps: ISankeyChartProps): void {\n    if (prevProps.shouldResize !== this.props.shouldResize) {\n      this._fitParentContainer();\n    }\n  }\n  public componentWillUnmount(): void {\n    cancelAnimationFrame(this._reqID);\n  }\n  public render(): React.ReactNode {\n    const { theme, className, styles, pathColor } = this.props;\n    this._classNames = getClassNames(styles!, {\n      theme: theme!,\n      width: this.state.containerWidth,\n      height: this.state.containerHeight,\n      pathColor: pathColor,\n      className,\n    });\n    const margin = { top: 10, right: 0, bottom: 10, left: 0 };\n    const width = this.state.containerWidth - margin.left - margin.right;\n    const height =\n      this.state.containerHeight - margin.top - margin.bottom > 0\n        ? this.state.containerHeight - margin.top - margin.bottom\n        : 0;\n\n    const sankey = d3Sankey\n      .sankey()\n      .nodeWidth(5)\n      .nodePadding(6)\n      .extent([\n        [1, 1],\n        [width - 1, height - 6],\n      ]);\n\n    sankey(this.props.data.SankeyChartData!);\n    const nodeData = this._createNodes(width);\n    const linkData = this._createLinks();\n    return (\n      <div\n        className={this._classNames.root}\n        role={'presentation'}\n        ref={(rootElem: HTMLDivElement) => (this.chartContainer = rootElem)}\n      >\n        <svg width={width} height={height} id={getId('sankeyChart')}>\n          <g className={this._classNames.nodes}>{nodeData}</g>\n          <g className={this._classNames.links} strokeOpacity={0.2}>\n            {linkData}\n          </g>\n        </svg>\n      </div>\n    );\n  }\n\n  private _createLinks(): React.ReactNode[] | undefined {\n    const links: React.ReactNode[] = [];\n    if (this.props.data.SankeyChartData) {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      this.props.data.SankeyChartData.links.forEach((singleLink: any, index: number) => {\n        const path = d3Sankey.sankeyLinkHorizontal();\n        const pathValue = path(singleLink);\n        const link = (\n          <path\n            key={index}\n            d={pathValue ? pathValue : undefined}\n            strokeWidth={Math.max(1, singleLink.width)}\n            id={getId('link')}\n          >\n            <title>\n              <text>{singleLink.source.name + ' â†’ ' + singleLink.target.name + '\\n' + singleLink.value}</text>\n            </title>\n          </path>\n        );\n        links.push(link);\n      });\n    }\n    return links;\n  }\n\n  private _createNodes(width: number): React.ReactNode[] | undefined {\n    const nodes: React.ReactNode[] = [];\n    if (this.props.data.SankeyChartData) {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      this.props.data.SankeyChartData.nodes.forEach((singleNode: any, index: number) => {\n        const height = singleNode.y1 - singleNode.y0 > 0 ? singleNode.y1 - singleNode.y0 : 0;\n        const node = (\n          <g id={getId('nodeGElement')} key={index}>\n            <rect\n              x={singleNode.x0}\n              y={singleNode.y0}\n              height={height}\n              width={singleNode.x1 - singleNode.x0}\n              fill={singleNode.color}\n              id={getId('nodeBar')}\n            />\n            <text\n              x={singleNode.x0 < width / 2 ? singleNode.x1 + 6 : singleNode.x0 - 6}\n              y={(singleNode.y1 + singleNode.y0) / 2}\n              dy={'0.35em'}\n              textAnchor={singleNode.x0 < width / 2 ? 'start' : 'end'}\n            >\n              {singleNode.name}\n            </text>\n            <title>\n              <text>{singleNode.name + '\\n' + singleNode.value}</text>\n            </title>\n          </g>\n        );\n        nodes.push(node);\n      });\n      return nodes;\n    }\n  }\n  private _fitParentContainer(): void {\n    const { containerWidth, containerHeight } = this.state;\n    this._reqID = requestAnimationFrame(() => {\n      const container = this.props.parentRef ? this.props.parentRef : this.chartContainer;\n      const currentContainerWidth = container.getBoundingClientRect().width;\n      const currentContainerHeight = container.getBoundingClientRect().height;\n      const shouldResize = containerWidth !== currentContainerWidth || containerHeight !== currentContainerHeight;\n      if (shouldResize) {\n        this.setState({\n          containerWidth: currentContainerWidth,\n          containerHeight: currentContainerHeight,\n        });\n      }\n    });\n  }\n}\n"]}